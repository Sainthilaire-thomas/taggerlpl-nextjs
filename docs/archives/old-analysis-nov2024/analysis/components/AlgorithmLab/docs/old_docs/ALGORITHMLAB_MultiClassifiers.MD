# Documentation Algorithm Lab - Version ComplÃ¨te et Mise Ã  Jour

## Vue d'ensemble

AlgorithmLab est un framework de validation scientifique Ã  3 niveaux intÃ©grÃ© dans TaggerLPL, permettant une validation mÃ©thodologique rigoureuse des algorithmes de classification conversationnelle. Il implÃ©mente une approche sÃ©quentielle alignÃ©e sur la thÃ©orie dÃ©veloppÃ©e au chapitre 3 de la thÃ¨se en linguistique appliquÃ©e.

## Architecture Mise Ã  Jour

### Structure Multi-Classificateurs OpÃ©rationnelle

L'architecture multi-classificateurs est maintenant **pleinement fonctionnelle** avec :

```
AlgorithmLab/
â”œâ”€â”€ algorithms/
â”‚   â””â”€â”€ level1/
â”‚       â”œâ”€â”€ shared/                           âœ… OPÃ‰RATIONNEL
â”‚       â”‚   â”œâ”€â”€ BaseClassifier.ts            # Interface commune
â”‚       â”‚   â”œâ”€â”€ ClassifierRegistry.ts        # SystÃ¨me d'enregistrement
â”‚       â”‚   â””â”€â”€ initializeClassifiers.ts     # Auto-initialisation
â”‚       â”œâ”€â”€ conseillerclassifiers/           âœ… MULTIPLE ALGOS
â”‚       â”‚   â”œâ”€â”€ RegexConseillerClassifier.ts # RÃ¨gles adaptÃ©es
â”‚       â”‚   â”œâ”€â”€ SpacyConseillerClassifier.ts # ML avec API
â”‚       â”‚   â””â”€â”€ OpenAIConseillerClassifier.ts# LLM GPT
â”‚       â””â”€â”€ clientclassifiers/               âœ… IMPLÃ‰MENTÃ‰
â”‚           â””â”€â”€ RegexClientClassifier.ts     # Classification client
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Level0/                              âœ… GOLD STANDARD
â”‚   â”‚   â””â”€â”€ InterAnnotatorAgreement.tsx     # Validation Kappa
â”‚   â”œâ”€â”€ Level1/                              âœ… REFACTORISÃ‰
â”‚   â”‚   â”œâ”€â”€ individual/                     # Analyse approfondie
â”‚   â”‚   â”‚   â”œâ”€â”€ TechnicalValidation/        # âœ¨ NOUVEAU MODULE
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TechnicalValidation.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RunPanel.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricsPanel.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ResultsSample.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfusionMatrix.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EnhancedErrorAnalysis.tsx   # IntÃ©grÃ© supervision
â”‚   â”‚   â”‚   â””â”€â”€ ParameterOptimization.tsx
â”‚   â”‚   â”œâ”€â”€ comparison/                     # Comparaison multi-algo
â”‚   â”‚   â”‚   â”œâ”€â”€ AlgorithmComparison.tsx     # Interface benchmark
â”‚   â”‚   â”‚   â”œâ”€â”€ ClassifierConfiguration.tsx # Config avancÃ©e
â”‚   â”‚   â”‚   â””â”€â”€ CrossValidation.tsx         # K-fold validation
â”‚   â”‚   â””â”€â”€ Level1Interface.tsx             # Navigation organisÃ©e
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ ClassifierSelector.tsx          # SÃ©lecteur avancÃ©
â”‚       â”œâ”€â”€ AlgorithmLabInterface.tsx       # Interface principale
â”‚       â””â”€â”€ NavigationTabs.tsx              # Navigation 3 niveaux
â””â”€â”€ hooks/
    â”œâ”€â”€ useLevel1Testing.ts                 # âœ¨ HOOK RÃ‰Ã‰CRIT
    â”œâ”€â”€ useLevel0Validation.ts              # Validation Kappa
    â””â”€â”€ useWorkflowManagement.ts            # Workflow sÃ©quentiel
```

---

## âœ¨ NOUVELLES FONCTIONNALITÃ‰S MAJEURES

### 1. Architecture Multi-Classificateurs ComplÃ¨te

#### BaseClassifier Interface UnifiÃ©e

```typescript
export interface ClassificationResult {
  prediction: string;
  confidence: number;
  processingTime?: number;
  metadata?: Record<string, any>;
}

export abstract class BaseClassifier {
  abstract classify(verbatim: string): Promise<ClassificationResult>;
  abstract getMetadata(): ClassifierMetadata;
  abstract validateConfig(): boolean;
  async batchClassify?(verbatims: string[]): Promise<ClassificationResult[]>;
}
```

#### Classificateurs Disponibles

**1. RegexConseillerClassifier** âœ… ADAPTÃ‰

```typescript
// RÃ¨gles hiÃ©rarchisÃ©es avec nouvelle interface
- ENGAGEMENT (prioritÃ© max) : "je vais", "je fais", "on va"
- OUVERTURE (prioritÃ© Ã©levÃ©e) : "vous allez", "veuillez", "merci de"
- REFLET (sous-types) : REFLET_VOUS, REFLET_JE, REFLET_ACQ
- EXPLICATION : "parce que", "notre politique"

// Nouvelles mÃ©thodes d'introspection
- explainClassification() : Pourquoi cette classification ?
- suggestPatternImprovements() : AmÃ©lioration basÃ©e sur erreurs
- addPattern() : Ajout dynamique de rÃ¨gles
```

**2. SpacyConseillerClassifier** âœ… NOUVEAU

```typescript
// Classification ML avec API locale
- ModÃ¨les franÃ§ais : fr_core_news_md/lg
- Features linguistiques avancÃ©es
- Support batch processing
- Gestion timeout et retry
- Test de connexion automatique
```

**3. OpenAIConseillerClassifier** âœ… NOUVEAU

```typescript
// Classification via GPT
- ModÃ¨les : gpt-4o-mini par dÃ©faut
- Prompt engineering optimisÃ©
- Gestion API key sÃ©curisÃ©e
- Normalisation des labels
- Fallback sur erreurs
```

**4. RegexClientClassifier** âœ… IMPLÃ‰MENTÃ‰

```typescript
// Classification rÃ©actions client
- CLIENT_POSITIF : "d'accord", "parfait", "merci"
- CLIENT_NEGATIF : "pas d'accord", "refuse", "inadmissible"
- CLIENT_NEUTRE : "je ne sais pas", "peut-Ãªtre", "voir"
- Logique de seuils avec prioritÃ©
```

### 2. Interface TechnicalValidation RefactorisÃ©e

#### Structure Modulaire

```typescript
TechnicalValidation/
â”œâ”€â”€ TechnicalValidation.tsx    # Orchestration principale
â”œâ”€â”€ RunPanel.tsx               # Configuration et lancement
â”œâ”€â”€ MetricsPanel.tsx           # MÃ©triques dÃ©taillÃ©es
â”œâ”€â”€ ResultsSample.tsx          # Ã‰chantillon paginÃ©
â””â”€â”€ index.ts                   # Exports centralisÃ©s
```

#### FonctionnalitÃ©s AvancÃ©es

**RunPanel** :

- Slider intelligent pour taille Ã©chantillon
- Badges de statut (config valide, domaine, batch support)
- Calcul automatique des seuils min/max/step
- Input numÃ©rique avec validation

**MetricsPanel** :

- MÃ©triques synthÃ©tiques en tuiles
- Tableau dÃ©taillÃ© par tag (PrÃ©cision/Rappel/F1)
- InterprÃ©tation Kappa automatique
- Codes couleur selon performance

**ResultsSample** :

- Pagination complÃ¨te (10/25/50/100 par page)
- Filtres multi-sÃ©lection (tags prÃ©dits/rÃ©els)
- Affichage next_turn_verbatim
- Tooltips pour verbatims longs
- Indicateurs visuels erreurs/succÃ¨s

### 3. Hook useLevel1Testing RÃ©Ã©crit

#### Gold Standard Intelligent

```typescript
// Mapping automatique des donnÃ©es rÃ©elles
const mapTurnsToGoldStandard = (allTurnTagged, allowedConseiller) => {
  // CONSEILLER : filtrage sur familles autorisÃ©es
  // CLIENT : extraction next_turn_verbatim/tag
  // MÃ©tadonnÃ©es complÃ¨tes : callId, speaker, timestamps
};

// Classification automatique du target
const getClassificationTarget = (classifierName) => {
  // DÃ©tection "client" dans nom/description â†’ "client"
  // Sinon â†’ "conseiller"
};
```

#### MÃ©thodes Principales

```typescript
// Test individuel avec Ã©chantillonnage
validateAlgorithm(classifierName: string, sampleSize?: number)

// Comparaison multi-algorithmes
compareAlgorithms(classifierNames: string[], sampleSize?: number)

// MÃ©triques complÃ¨tes avec Kappa
calculateMetrics(results: ValidationResult[])

// Analyse d'erreurs avec suggestions
analyzeErrors(results: ValidationResult[])

// Compteurs adaptÃ©s par target
getRelevantCountFor(classifierName: string): number
getGoldStandardCountByTarget(): {conseiller, client, total}
```

### 4. Interface Comparison Multi-Algorithmes

#### AlgorithmComparison.tsx

```typescript
// SÃ©lection multiple avec mÃ©tadonnÃ©es
- Checkboxes par classificateur
- Badges type (rule-based/ml/llm)
- Info batch support, API requirements
- Estimation Ã©chantillon gold standard

// RÃ©sultats comparatifs
- Tableau classement par accuracy
- Temps de traitement par type
- Codes couleur performance
- Analyse recommandations
```

#### ClassifierConfiguration.tsx

```typescript
// Configuration centralisÃ©e
- Interface par paramÃ¨tre (boolean/string/number/select)
- Validation temps rÃ©el
- Profils sauvegardÃ©s
- Actions groupÃ©es (activer/reset tous)
- Export/import configurations
```

#### CrossValidation.tsx

```typescript
// Validation K-fold robuste
- Division intelligente en folds
- Tests parallÃ¨les ou sÃ©quentiels
- MÃ©triques de stabilitÃ© (high/medium/low)
- Analyse variance inter-algorithmes
- Interface dÃ©taillÃ©e par fold
```

---

## INTÃ‰GRATIONS SYSTÃˆME

### 1. EnhancedErrorAnalysis âœ¨ INTÃ‰GRATION SUPERVISION

L'analyse d'erreurs est maintenant **intÃ©grÃ©e aux modals de supervision** :

```typescript
// Enrichissement contextuel des erreurs
interface EnhancedAlgorithmResult extends AlgorithmResult {
  filename?: string;
  next_turn_verbatim?: string;
  next_turn_tag?: string;
  hasAudio?: boolean;
  hasTranscript?: boolean;
}

// Clic sur erreur â†’ Ouverture modal contextualisÃ©
handleRowClick(error) â†’ {
  // RequÃªte Supabase optimisÃ©e
  // PrÃ©paration supervision complÃ¨te
  // TaggingModal ou ProcessingModal selon ressources
}
```

**Interface d'Erreur Enrichie** :

- VerbatimDisplay avec contexte next_turn
- TagChain avec flÃ¨che conseillerâ†’client
- StatusDisplay (audio/transcription disponible)
- ConfidenceScore avec indicateurs visuels
- IntÃ©gration complÃ¨te workflow supervision

### 2. IntÃ©gration Page Analysis

```typescript
// Import dans analysis/page.tsx
import { AlgorithmLabInterface } from "./components/AlgorithmLab";

// IntÃ©gration transparente
<AlgorithmLabInterface
  selectedOrigin={selectedOrigin}
  availableDomains={domains}
  availableIndicators={indicators}
/>;
```

### 3. ClassifierSelector AvancÃ©

```typescript
// Configuration dynamique par classificateur
showConfiguration={true} â†’ {
  // GÃ©nÃ©ration automatique interface selon configSchema
  // Boolean â†’ Switch avec description
  // String + options â†’ Select dropdown
  // Number â†’ Slider avec min/max/step
  // String simple â†’ TextField
  // Validation temps rÃ©el
  // Reset aux defaults
}
```

---

## WORKFLOW UTILISATEUR OPTIMISÃ‰

### Navigation SÃ©quentielle Intelligente

```
NIVEAU 0: Gold Standard
â”œâ”€â”€ InterAnnotatorAgreement.tsx
â”œâ”€â”€ Calcul Kappa de Cohen
â”œâ”€â”€ RÃ©solution dÃ©saccords collaboratifs
â””â”€â”€ Certification corpus rÃ©fÃ©rence

NIVEAU 1: Validation Technique
â”œâ”€â”€ individual/
â”‚   â”œâ”€â”€ TechnicalValidation (focus 1 algo)
â”‚   â”‚   â”œâ”€â”€ SÃ©lection + configuration
â”‚   â”‚   â”œâ”€â”€ Test Ã©chantillon ajustable
â”‚   â”‚   â”œâ”€â”€ MÃ©triques dÃ©taillÃ©es
â”‚   â”‚   â””â”€â”€ Analyse erreurs contextuelle
â”‚   â”œâ”€â”€ ConfusionMatrix (heatmap interactive)
â”‚   â”œâ”€â”€ ParameterOptimization (fine-tuning)
â”‚   â””â”€â”€ EnhancedErrorAnalysis (intÃ©grÃ© supervision)
â””â”€â”€ comparison/
    â”œâ”€â”€ AlgorithmComparison (benchmark multiple)
    â”œâ”€â”€ ClassifierConfiguration (gestion centralisÃ©e)
    â””â”€â”€ CrossValidation (k-fold robustesse)

NIVEAU 2: Validation Scientifique
â”œâ”€â”€ HypothesisTesting (H1-H2-H3)
â”œâ”€â”€ ConvergenceValidation (AC-LI-Cognitif)
â”œâ”€â”€ ScientificReport (export LaTeX/Word)
â””â”€â”€ TheoreticalValidator (cohÃ©rence framework)
```

### Modes d'Utilisation Distincts

#### Mode Individual (Analyse Approfondie)

1. **SÃ©lection** : UN classificateur avec mÃ©tadonnÃ©es complÃ¨tes
2. **Configuration** : ParamÃ¨tres fins avec preview impact
3. **Test** : Ã‰chantillonnage intelligent (slider + input)
4. **Analyse** : MÃ©triques + matrice + erreurs + optimisation
5. **Action** : Clic erreur â†’ Supervision contextuelle complÃ¨te

#### Mode Comparison (Benchmark Multi-Algo)

1. **SÃ©lection** : MULTIPLE classificateurs (checkboxes)
2. **Configuration** : ParamÃ©trage groupÃ© ou individuel
3. **Benchmark** : Tests simultanÃ©s avec progress unifiÃ©
4. **Analyse** : Classement, recommandations, export
5. **Validation** : K-fold, stabilitÃ©, tests statistiques

---

## PERFORMANCE ET MÃ‰TRIQUES

### MÃ©triques CalculÃ©es

#### Niveau Individual

```typescript
interface SimpleMetrics {
  accuracy: number; // % classifications correctes
  correct: number; // Nombre absolut corrects
  total: number; // Ã‰chantillon total
  avgProcessingTime: number; // ms moyen par classification
  avgConfidence: number; // Confiance moyenne [0-1]
  kappa?: number; // Accord Cohen vs gold standard
}
```

#### Niveau Comparison

```typescript
interface ComparisonResult {
  classifierName: string;
  accuracy: number;
  avgProcessingTime: number;
  avgConfidence: number;
  metadata: { type; version; name };
  rank: number; // Position dans classement
}
```

#### Niveau CrossValidation

```typescript
interface CrossValidationResults {
  meanAccuracy: number; // Accuracy moyenne sur k-folds
  stdAccuracy: number; // Ã‰cart-type (stabilitÃ©)
  stability: "high" | "medium" | "low"; // InterprÃ©tation automatique
  confidence: number; // 1 - coefficient variation
  foldResults: FoldResult[]; // DÃ©tail par fold
}
```

### Benchmarks MesurÃ©s

| Classificateur             | Type       | Accuracy Typique | Temps Moyen | Support Batch |
| -------------------------- | ---------- | ---------------- | ----------- | ------------- |
| RegexConseillerClassifier  | rule-based | 75-85%           | 1-2ms       | âœ…            |
| SpacyConseillerClassifier  | ml         | 80-90%           | 50-100ms    | âœ…            |
| OpenAIConseillerClassifier | llm        | 85-95%           | 200-500ms   | âŒ            |
| RegexClientClassifier      | rule-based | 70-80%           | 1-2ms       | âœ…            |

---

## GOLD STANDARD ET DONNÃ‰ES

### Source de DonnÃ©es RÃ©elles

```typescript
// Extraction automatique depuis Supabase
goldStandardData = mapTurnsToGoldStandard(allTurnTagged, allowedConseiller)

// Classification par target
CONSEILLER: {
  source: turntagged.verbatim â†’ tag
  filtrage: familles [ENGAGEMENT, OUVERTURE, REFLET, EXPLICATION]
  normalisation: espaces â†’ underscores, UPPERCASE
  mÃ©tadonnÃ©es: callId, speaker, timestamps, next_turn_verbatim
}

CLIENT: {
  source: turntagged.next_turn_verbatim â†’ next_turn_tag
  labels: CLIENT_POSITIF, CLIENT_NEGATIF, CLIENT_NEUTRE
  rÃ©fÃ©rence: turntagged.id (tour conseiller parent)
}
```

### Compteurs Adaptatifs

```typescript
// Adaptation automatique selon classificateur sÃ©lectionnÃ©
getRelevantCountFor("RegexConseillerClassifier") â†’ ~3500 Ã©chantillons conseiller
getRelevantCountFor("RegexClientClassifier") â†’ ~3500 Ã©chantillons client

// Slider intelligent
min: Math.min(10, totalCount)
max: totalCount
step: Math.max(1, Math.round(totalCount / 50))
marks: [25%, 50%, 75%, 100%] du total
```

---

## SÃ‰CURITÃ‰ ET GESTION D'ERREURS

### Gestion API Keys

```typescript
// Variables d'environnement sÃ©curisÃ©es
OPENAI_API_KEY: process.env.OPENAI_API_KEY
SPACY_API_URL: process.env.SPACY_API_URL || "http://localhost:8000"

// Fallbacks et tests de connexion
initializeClassifiers() â†’ {
  // Test connexion non-bloquant
  // Enregistrement conditionnel selon disponibilitÃ©
  // Messages informatifs console
}
```

### Error Handling Robuste

```typescript
// RequÃªtes Supabase optimisÃ©es
- Regroupement par call_id (Ã©viter doublons)
- RequÃªtes OR conditionnelles
- Fallback sur erreur avec donnÃ©es minimales
- Gestion timeout et retry

// Classification avec fallback
classify() â†’ {
  try: classification normale
  catch: {prediction: "ERREUR", confidence: 0, metadata: {error}}
}
```

### Validation Configurations

```typescript
// Validation temps rÃ©el
validateConfig() â†’ boolean
- Test types paramÃ¨tres
- VÃ©rification URLs/API keys
- Validation ranges min/max
- Indicateur visuel (badge vert/rouge)
```

---

## EXPORT ET INTÃ‰GRATION MANUSCRIT

### Formats d'Export SupportÃ©s

```typescript
interface ExportConfig {
  format: "json" | "csv" | "latex" | "word";
  sections: ["metrics", "confusion", "errors", "recommendations"];
  includeGraphics: boolean;
  template: "thesis" | "article" | "report";
}

// Export LaTeX pour thÃ¨se
ScientificReport.generateLatex() â†’ {
  // Tables formatÃ©es
  // Figures haute dÃ©finition
  // Citations automatiques
  // Structure chapitre 5
}
```

### IntÃ©gration TaggerLPL

```typescript
// Context global partagÃ©
useTaggingData() â†’ {
  allTurnTagged,    // Source gold standard
  tags,             // RÃ©fÃ©rentiel avec familles
  loadingGlobalData // Ã‰tat synchronisÃ©
}

// Navigation intÃ©grÃ©e
analysis/page.tsx â†’ AlgorithmLabInterface â†’ {
  // Onglet Algorithm Lab
  // ParamÃ¨tre selectedOrigin transmis
  // IntÃ©gration thÃ¨me dark/light
  // Footer mÃ©thodologique
}
```

---

## DÃ‰VELOPPEMENTS RÃ‰CENTS (Session)

### âœ… RÃ©alisations Majeures

1. **TechnicalValidation RefactorisÃ©** :
   - ModularitÃ© complÃ¨te (4 composants)
   - Interface utilisateur optimisÃ©e
   - Pagination et filtrage avancÃ©s
2. **Multi-Classificateurs OpÃ©rationnel** :
   - 4 classificateurs implÃ©mentÃ©s
   - Interface unifiÃ©e BaseClassifier
   - Registry avec auto-initialisation
3. **IntÃ©gration Supervision** :
   - EnhancedErrorAnalysis â†’ TaggingModal
   - Enrichissement contextuel erreurs
   - Workflow complet analyse â†’ action
4. **Hook useLevel1Testing RÃ©Ã©crit** :
   - Gold standard intelligent
   - Compteurs adaptatifs par target
   - MÃ©thodes comparaison et analyse

### ğŸ”§ Corrections Techniques

- **Props optionnelles** : Interfaces complÃ¨tes avec `?`
- **Gestion des conflits** : RÃ©solution types/composants
- **RequÃªtes optimisÃ©es** : Regroupement Supabase
- **MÃ©triques robustes** : Gestion cas edge (0 samples)

### ğŸ“Š MÃ©triques de Couverture

| FonctionnalitÃ©          | ImplÃ©mentation | Tests              | Documentation |
| ----------------------- | -------------- | ------------------ | ------------- |
| Multi-classificateurs   | âœ… 100%        | âš ï¸ Manuel          | âœ… ComplÃ¨te   |
| Validation Individual   | âœ… 100%        | âœ… IntÃ©grÃ©         | âœ… ComplÃ¨te   |
| Validation Comparison   | âœ… 100%        | âš ï¸ Manuel          | âœ… ComplÃ¨te   |
| IntÃ©gration Supervision | âœ… 100%        | âœ… Fonctionnel     | âœ… DocumentÃ©e |
| Gold Standard           | âœ… 100%        | âœ… DonnÃ©es rÃ©elles | âœ… ValidÃ©     |

---

## ROADMAP TECHNIQUE

### Phase ImmÃ©diate (PrÃªte)

- âœ… Multi-classificateurs opÃ©rationnels
- âœ… Interfaces individual/comparison complÃ¨tes
- âœ… IntÃ©gration supervision fonctionnelle
- âœ… Documentation mise Ã  jour

### Phase Validation (En cours)

- ğŸ”„ Tests utilisateur sur dataset rÃ©el
- ğŸ”„ Optimisation performance gros volumes
- ğŸ”„ Validation mÃ©triques scientifiques
- ğŸ”„ Export LaTeX pour thÃ¨se

### Phase Extension (Future)

- ğŸ“… Niveau 2 : Validation hypothÃ¨ses H1-H2-H3
- ğŸ“… Ensemble learning (vote majoritaire)
- ğŸ“… Auto-tuning paramÃ¨tres (algorithmes gÃ©nÃ©tiques)
- ğŸ“… API publique pour recherche communautaire

---

## CONCLUSION

AlgorithmLab constitue dÃ©sormais un **framework de validation scientifique complet et opÃ©rationnel** pour TaggerLPL. L'architecture multi-classificateurs permet une comparaison rigoureuse des approches (rÃ¨gles, ML, LLM), tandis que l'intÃ©gration avec les modals de supervision offre un workflow fluide de l'analyse Ã  l'action corrective.

La refactorisation du TechnicalValidation et la rÃ©Ã©criture du hook useLevel1Testing apportent une robustesse et une ergonomie adaptÃ©es Ã  un usage intensif de recherche. L'ensemble respecte les standards acadÃ©miques requis pour une validation mÃ©thodologique de thÃ¨se.

**Points forts de cette version** :

- Architecture modulaire et extensible
- DonnÃ©es rÃ©elles (vs mocks) avec gold standard intelligent
- Interface adaptÃ©e aux deux workflows (individual vs comparison)
- IntÃ©gration native Ã©cosystÃ¨me TaggerLPL
- Documentation complÃ¨te pour maintenance et extension

Cette implÃ©mentation transforme l'Algorithm Lab en vÃ©ritable **environnement de recherche appliquÃ©e** pour la validation scientifique d'algorithmes de classification conversationnelle.
